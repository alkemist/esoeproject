<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="metadata">

	<!-- Parameter Maps -->
	<parameterMap id="descriptorType" class="java.util.HashMap">
		<parameter property="ENT_ID" jdbcType="NUMBER" javaType="java.lang.Integer" />
		<parameter property="descriptorTypeID" jdbcType="NUMBER" javaType="java.lang.String" />
	</parameterMap>

	<!-- Result Maps -->
	<resultMap id="descriptorMap" class="java.util.HashMap">
		<result property="DESC_ID" column="DESC_ID" javaType="java.lang.Integer"/>
		<result property="descriptorXML" column="DESCRIPTORXML" jdbcType="BLOB"	javaType="[B" />
	</resultMap>

	<resultMap id="contactPersonMap" class="java.util.HashMap">
		<result property="contactType" column="CONTACTTYPE" javaType="java.lang.String" />
		<result property="company" column="COMPANY" javaType="java.lang.String" />
		<result property="givenName" column="GIVENNAME" javaType="java.lang.String" />
		<result property="surname" column="SURNAME" javaType="java.lang.String" />
		<result property="emailAddress" column="EMAILADDRESS" javaType="java.lang.String" />
		<result property="telephoneNumber" column="TELEPHONENUMBER" javaType="java.lang.String" />
	</resultMap>
	
	<resultMap id="publicKeyMap" class="java.util.HashMap">
		<result property="DESC_ID" column="DESC_ID" javaType="java.lang.Integer" />
		<result property="expiryDate" column="EXPIRYDATE" javaType="java.util.Date" />
		<result property="keyName" column="KEYNAME" javaType="java.lang.String" />
		<result property="publicKey" column="PUBLICKEY" jdbcType="BLOB" javaType="[B" />
	</resultMap>

	<!-- Select Statements -->
	<select id="getEntityID" parameterClass="java.lang.Integer" resultClass="java.lang.String">
		SELECT ENTITYID FROM ENTITY_DESCRIPTORS WHERE ENT_ID = #value#
	</select>
	
	<select id="getActiveEntityIDList" resultClass="java.lang.Integer">
		SELECT ENT_ID FROM ENTITY_DESCRIPTORS 
		WHERE ACTIVEFLAG = 'y'
	</select>

	<select id="getIDPList" parameterMap="descriptorType" resultMap="descriptorMap">
		SELECT DESC_ID, DESCRIPTORXML FROM DESCRIPTORS WHERE 
		ENT_ID = ?
		AND DESCRIPTORTYPEID = ?
	</select>

	<select id="getSPList" parameterMap="descriptorType" resultMap="descriptorMap">
		SELECT DESC_ID, DESCRIPTORXML FROM DESCRIPTORS WHERE 
		ENT_ID = ?
		AND DESCRIPTORTYPEID = ?
	</select>

	<select id="getAttributeAuthorityList" parameterMap="descriptorType" resultMap="descriptorMap">
		SELECT DESC_ID, DESCRIPTORXML FROM DESCRIPTORS WHERE 
		ENT_ID = ?
		AND DESCRIPTORTYPEID = ?
	</select>

	<select id="getLXACMLPDPList" parameterMap="descriptorType" resultMap="descriptorMap">
		SELECT DESC_ID, DESCRIPTORXML FROM DESCRIPTORS WHERE 
		ENT_ID = ?
		AND DESCRIPTORTYPEID = ?
	</select>

	<select id="getContacts" parameterClass="java.lang.Integer" resultMap="contactPersonMap">
		SELECT * FROM ENTITY_CONTACTS WHERE 
		ENT_ID = #value#
	</select>
	
	<select id="getPublicKeyData" parameterClass="java.lang.Integer" resultMap="publicKeyMap">
		SELECT * FROM DESCRIPTOR_PUBLIC_KEYS WHERE DESC_ID = #value# AND EXPIRYDATE <![CDATA[ > ]]> CURRENT_TIMESTAMP
	</select>

</sqlMap>