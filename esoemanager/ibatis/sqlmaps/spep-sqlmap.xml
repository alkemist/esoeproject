<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="spep">

	<!-- Parameter Maps -->
	<parameterMap id="entityDescriptorMap" class="java.util.HashMap">
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="organizationName" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="organizationDisplayName" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<parameter property="organizationURL" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="activeFlag" jdbcType="CHAR" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="serviceDescriptionMap" class="java.util.HashMap">
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="serviceName" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="serviceURL" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="serviceDesc" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="authzFailureMsg" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="serviceNodeMap" class="java.util.HashMap">
		<parameter property="endpointID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="descriptorID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="nodeURL" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="assertionConsumerEndpoint" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<parameter property="singleLogoutEndpoint" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="cacheClearEndpoint" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="serviceContactMap" class="java.util.HashMap">
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="contactID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="contactType" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="company" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="givenName" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="surname" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="emailAddress" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="telephoneNumber" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="updateContactMap" class="java.util.HashMap">
		<parameter property="company" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="givenName" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="surname" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="emailAddress" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="telephoneNumber" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="contactType" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="contactID" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="serviceActiveMap" class="java.util.HashMap">
		<parameter property="activeFlag" jdbcType="CHAR" javaType="java.lang.String" />
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="descriptorMap" class="java.util.HashMap">
		<parameter property="descriptorID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="descriptorXML" jdbcType="CLOB" javaType="java.lang.String" />
		<parameter property="descriptorTypeID" jdbcType="NUMBER" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="pkiMap" class="java.util.HashMap">
		<parameter property="descriptorID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="expiryDate" jdbcType="DATETIME" javaType="java.util.Date" />
		<parameter property="keyPairName" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="keyPairPassphrase" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="keyStore" jdbcType="BLOB" javaType="[B" />
		<parameter property="keyStorePassphrase" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="descriptorType" class="java.util.HashMap">
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="descriptorTypeID" jdbcType="NUMBER" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="delServiceContactMap" class="java.util.HashMap">
		<parameter property="entityID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<parameter property="contactID" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="updateServiceDescriptionMap" class="java.util.HashMap">
		<parameter property="serviceName" javaType="java.lang.String" />
		<parameter property="serviceURL" javaType="java.lang.String" />
		<parameter property="serviceDesc" javaType="java.lang.String" />
		<parameter property="authzFailureMsg" javaType="java.lang.String" />
		<parameter property="entityID" javaType="java.lang.String" />
	</parameterMap>

	<parameterMap id="insertAuthorizationPolicy" class="java.util.HashMap">
		<parameter property="descriptorID" javaType="java.lang.String" />
		<parameter property="lxacmlPolicy" jdbcType="CLOB" javaType="java.lang.String" />
		<parameter property="lxacmlDate" jdbcType="DATETIME" javaType="java.util.Date" />
	</parameterMap>

	<parameterMap id="updateAuthorizationPolicy" class="java.util.HashMap">
		<parameter property="lxacmlPolicy" jdbcType="CLOB" javaType="java.lang.String" />
		<parameter property="lxacmlDate" jdbcType="DATETIME" javaType="java.util.Date" />
		<parameter property="descriptorID" javaType="java.lang.String" />
	</parameterMap>

	<!-- Result Maps -->
	<resultMap id="keyStoreMap" class="java.util.HashMap">
		<result property="keyStore" column="KEYSTORE" jdbcType="BLOB" javaType="[B" />
		<result property="keyStorePassphrase" column="KEYSTORE_PASSPHRASE"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap id="descriptorMap" class="java.util.HashMap">
		<result property="descriptorID" column="DESCRIPTORID" javaType="java.lang.String" />
		<result property="descriptorXML" column="DESCRIPTORXML" jdbcType="CLOB"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap id="contactPersonMap" class="java.util.HashMap">
		<result property="contactID" column="CONTACTID" javaType="java.lang.String" />
		<result property="contactType" column="CONTACTTYPE" javaType="java.lang.String" />
		<result property="company" column="COMPANY" javaType="java.lang.String" />
		<result property="givenName" column="GIVENNAME" javaType="java.lang.String" />
		<result property="surname" column="SURNAME" javaType="java.lang.String" />
		<result property="emailAddress" column="EMAILADDRESS" javaType="java.lang.String" />
		<result property="telephoneNumber" column="TELEPHONENUMBER" javaType="java.lang.String" />
	</resultMap>

	<resultMap id="serviceDescriptionMap" class="java.util.HashMap">
		<result property="serviceName" column="SERVICENAME" javaType="java.lang.String" />
		<result property="serviceURL" column="SERVICEURL" javaType="java.lang.String" />
		<result property="serviceDesc" column="SERVICEDESC" javaType="java.lang.String" />
		<result property="authzFailureMsg" column="AUTHZFAILUREMSG" javaType="java.lang.String" />
	</resultMap>

	<resultMap id="serviceDetailsMap" class="java.util.HashMap">
		<result property="entityID" column="ENTITYID" javaType="java.lang.String" />
		<result property="organizationName" column="ORGANIZATIONNAME" javaType="java.lang.String" />
		<result property="organizationDisplayName" column="ORGANIZATIONDISPLAYNAME"
			javaType="java.lang.String" />
		<result property="organizationURL" column="ORGANIZATIONURL" javaType="java.lang.String" />
		<result property="activeFlag" column="ACTIVEFLAG" javaType="java.lang.String" />
	</resultMap>

	<resultMap id="serviceNodesMap" class="java.util.HashMap">
		<result property="endpointID" column="ENDPOINTID" javaType="java.lang.String" />
		<result property="descriptorID" column="DESCRIPTORID" javaType="java.lang.String" />
		<result property="nodeURL" column="NODEURL" javaType="java.lang.String" />
		<result property="assertionConsumerEndpoint" column="ASSERTIONCONSUMER_ENDPOINT"
			javaType="java.lang.String" />
		<result property="singleLogoutEndpoint" column="SINGLELOGOUT_ENDPOINT"
			javaType="java.lang.String" />
		<result property="cacheClearEndpoint" column="CACHECLEAR_ENDPOINT"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap id="keyStoreDetailsMap" class="java.util.HashMap">
		<result property="expiryDate" column="EXPIRYDATE" javaType="java.util.Date" />
		<result property="keyPairName" column="KEYPAIRNAME" javaType="java.lang.String" />
		<result property="keyStorePassphrase" column="KEYSTORE_PASSPHRASE"
			javaType="java.lang.String" />
		<result property="keyPairPassphrase" column="KEYPAIR_PASSPHRASE"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap id="activeAuthorizationPolicy" class="java.util.HashMap">
		<result property="descriptorID" column="DESCRIPTORID" javaType="java.lang.String" />
		<result property="lxacmlPolicy" column="LXACMLPOLICY" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="lxacmlDate" column="DATE_LAST_UPDATED" javaType="java.util.Date" />
	</resultMap>

	<!-- Select Statements -->
	<select id="getActiveServicesList" resultClass="string">
		SELECT ENTITY_DESCRIPTORS.ENTITYID FROM ENTITY_DESCRIPTORS LEFT JOIN (DESCRIPTORS) ON
		(DESCRIPTORS.ENTITYID=ENTITY_DESCRIPTORS.ENTITYID) WHERE DESCRIPTORS.DESCRIPTORTYPEID='2'
	</select>

	<select id="getKeyStore" resultMap="keyStoreMap">
		SELECT KEYSTORE, KEYSTORE_PASSPHRASE FROM PKI_STORES WHERE DESCRIPTORID = #value#
	</select>

	<select id="getServiceDescriptor" parameterMap="descriptorType" resultMap="descriptorMap">
		SELECT DESCRIPTORID, DESCRIPTORXML FROM DESCRIPTORS WHERE ENTITYID = ? AND DESCRIPTORTYPEID
		= ?
	</select>

	<select id="getServiceContacts" parameterClass="string" resultMap="contactPersonMap">
		SELECT * FROM ENTITY_CONTACTS WHERE ENTITYID = #value#
	</select>

	<select id="getServiceDescription" parameterClass="string" resultMap="serviceDescriptionMap">
		SELECT * FROM SERVICE_DESCRIPTIONS WHERE ENTITYID = #value#
	</select>

	<select id="getServiceDetails" parameterClass="string" resultMap="serviceDetailsMap">
		SELECT * FROM ENTITY_DESCRIPTORS WHERE ENTITYID = #value#
	</select>

	<select id="getServiceNodes" parameterClass="string" resultMap="serviceNodesMap">
		SELECT * FROM SERVICE_ENDPOINTS WHERE DESCRIPTORID = #value#
	</select>

	<select id="getKeyStoreDetails" parameterClass="string" resultMap="keyStoreDetailsMap">
		SELECT EXPIRYDATE, KEYPAIRNAME, KEYSTORE_PASSPHRASE, KEYPAIR_PASSPHRASE FROM PKI_STORES
		WHERE DESCRIPTORID=#value#
	</select>

	<select id="getActiveAuthorizationPolicy" parameterClass="string"
		resultMap="activeAuthorizationPolicy">
		SELECT * FROM SERVICE_POLICIES WHERE DESCRIPTORID = #value#
	</select>

	<!-- Insert Statements -->
	<insert id="insertEntityDescriptor" parameterMap="entityDescriptorMap">
		INSERT INTO ENTITY_DESCRIPTORS ( ENTITYID, ORGANIZATIONNAME, ORGANIZATIONDISPLAYNAME,
		ORGANIZATIONURL, ACTIVEFLAG ) VALUES ( ?, ?, ?, ?, ? )
	</insert>

	<insert id="insertServiceDescription" parameterMap="serviceDescriptionMap">
		INSERT INTO SERVICE_DESCRIPTIONS ( ENTITYID, SERVICENAME, SERVICEURL, SERVICEDESC,
		AUTHZFAILUREMSG) VALUES ( ?, ?, ?, ?, ? )
	</insert>

	<insert id="insertServiceNode" parameterMap="serviceNodeMap">
		INSERT INTO SERVICE_ENDPOINTS ( ENDPOINTID, DESCRIPTORID, NODEURL,
		ASSERTIONCONSUMER_ENDPOINT, SINGLELOGOUT_ENDPOINT, CACHECLEAR_ENDPOINT) VALUES ( ?, ?, ?, ?,
		?, ? )
	</insert>

	<insert id="insertServiceContacts" parameterMap="serviceContactMap">
		INSERT INTO ENTITY_CONTACTS ( ENTITYID, CONTACTID, CONTACTTYPE, COMPANY, GIVENNAME, SURNAME,
		EMAILADDRESS, TELEPHONENUMBER) VALUES( ?, ?, ?, ?, ?, ?, ?, ? )
	</insert>

	<insert id="insertDescriptor" parameterMap="descriptorMap">
		INSERT INTO DESCRIPTORS ( DESCRIPTORID, ENTITYID, DESCRIPTORXML, DESCRIPTORTYPEID ) VALUES (
		?, ?, ?, ? )
	</insert>

	<insert id="insertPKIData" parameterMap="pkiMap">
		INSERT INTO PKI_STORES (DESCRIPTORID, EXPIRYDATE, KEYPAIRNAME, KEYPAIR_PASSPHRASE, KEYSTORE,
		KEYSTORE_PASSPHRASE) VALUES (?, ?, ?, ?, ?, ?)
	</insert>

	<insert id="insertServiceAuthorizationPolicy" parameterMap="insertAuthorizationPolicy">
		INSERT INTO SERVICE_POLICIES (DESCRIPTORID, LXACMLPOLICY, DATE_LAST_UPDATED) VALUES (?, ?,
		?)
	</insert>

	<insert id="insertServiceAuthorizationShuntedPolicy" parameterMap="insertAuthorizationPolicy">
		INSERT INTO SERVICE_POLICIES_SHUNT (DESCRIPTORID, LXACMLPOLICY, DATE_INSERTED) VALUES (?, ?,
		?)
	</insert>

	<insert id="insertServiceAuthorizationHistoricalPolicy"
		parameterMap="insertAuthorizationPolicy">
		INSERT INTO SERVICE_POLICIES_HISTORICAL (DESCRIPTORID, LXACMLPOLICY, DATE_INSERTED) VALUES
		(?, ?, ?)
	</insert>

	<!-- Update Statements -->
	<update id="updateServiceContact" parameterMap="updateContactMap">
		UPDATE ENTITY_CONTACTS SET COMPANY=?, GIVENNAME=?, SURNAME=?, EMAILADDRESS=?,
		TELEPHONENUMBER=?, CONTACTTYPE=? WHERE ENTITYID=? AND CONTACTID=?
	</update>

	<update id="updateServiceActiveStatus" parameterMap="serviceActiveMap">
		UPDATE ENTITY_DESCRIPTORS SET ACTIVEFLAG=? WHERE ENTITYID=?
	</update>

	<update id="updateServiceDescription" parameterMap="updateServiceDescriptionMap">
		UPDATE SERVICE_DESCRIPTIONS SET SERVICENAME=?, SERVICEURL=?, SERVICEDESC=?,
		AUTHZFAILUREMSG=? WHERE ENTITYID=?
	</update>

	<update id="updateServiceAuthorizationPolicy" parameterMap="updateAuthorizationPolicy">
		UPDATE SERVICE_POLICIES SET LXACMLPOLICY=?, DATE_LAST_UPDATED=? WHERE DESCRIPTORID=?
	</update>

	<!-- Delete Statements -->
	<delete id="deleteServiceContact" parameterMap="delServiceContactMap">
		DELETE FROM ENTITY_CONTACTS WHERE ENTITYID=? AND CONTACTID=?
	</delete>

</sqlMap>